from fastapi import FastAPI, Query
from utils import *
from typing import Optional
import sqlite3

app = FastAPI()

# –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
services = {
    1: {
        "text": '‚ö°Ô∏è BOOST channel | 25-30 DAYS',
        "price": 42,
        "price_text": '42000‚ÇΩ –∑–∞ 1000',
        "description": '–°–°–´–õ–ö–£ –ù–£–ñ–ù–û –£–ö–ê–ó–´–í–ê–¢–¨ –ù–ê –°–ê–ú –ö–ê–ù–ê–õ<br>–°–°–´–õ–ö–ê –î–û–õ–ñ–ù–ê –ë–´–¢–¨ –ë–ï–ó –ó–ê–Ø–í–û–ö<br><br>–ë—É—Å—Ç—ã –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–µ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞–Ω–∞–ª—ã.<br>–ë—É—Å—Ç –¥–µ—Ä–∂–∏—Ç—Å—è 25-30 –¥–Ω–µ–π.<br>‚ö°Ô∏è –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏.<br>‚≠ê –õ–∏—á–Ω–∞—è –±–∞–∑–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –ø—Ä—è–º–æ–π –ø–æ—Å—Ç–∞–≤—â–∏–∫ —É—Å–ª—É–≥.',
        "minimum": 1,
        "bt_id": 198
    },
    2: {
        "text": '‚ö°Ô∏è BOOST channel | 1 DAYS',
        "price": 4,
        "price_text": '4000‚ÇΩ –∑–∞ 1000',
        "description": '–°–°–´–õ–ö–£ –ù–£–ñ–ù–û –£–ö–ê–ó–´–í–ê–¢–¨ –ù–ê –°–ê–ú –ö–ê–ù–ê–õ<br>–°–°–´–õ–ö–ê –î–û–õ–ñ–ù–ê –ë–´–¢–¨ –ë–ï–ó –ó–ê–Ø–í–û–ö<br><br>–ë—É—Å—Ç—ã –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–µ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ –∫–∞–Ω–∞–ª—ã.<br>–ë—É—Å—Ç –¥–µ—Ä–∂–∏—Ç—Å—è 1 –¥–µ–Ω—å.<br><br>‚ö°Ô∏è –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏.<br>‚≠ê –õ–∏—á–Ω–∞—è –±–∞–∑–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, –ø—Ä—è–º–æ–π –ø–æ—Å—Ç–∞–≤—â–∏–∫ —É—Å–ª—É–≥.',
        "minimum": 1,
        "bt_id": 181
    },
    3: {
        "text": 'ü§ñ Premium BOT START MIX',
        "price": 0.75,
        "price_text": '750‚ÇΩ –∑–∞ 1000',
        "description": '–ó–∞–ø—É—Å–∫ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ —Å –ø—Ä–µ–º –∞–∫–∞—É–Ω—Ç–æ–≤.<br><br>NON DROP<br><br>Geo MIX',
        "minimum": 1,
        "bt_id": 205
    },
    4: {
        "text": 'ü§ñ Premium BOT START RU',
        "price": 8.5,
        "price_text": '850‚ÇΩ –∑–∞ 1000',
        "description": '–ó–∞–ø—É—Å–∫ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ —Å –ø—Ä–µ–º –∞–∫–∞—É–Ω—Ç–æ–≤.<br><br>NON DROPE<br><br>Geo RU',
        "minimum": 1,
        "bt_id": 206
    },
    5: {
        "text": 'ü§ñ BOT START RU',
        "price": 0.2,
        "price_text": '200‚ÇΩ –∑–∞ 1000',
        "description": '–ó–∞–ø—É—Å–∫ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ \n<br><br>–∞–∫–∫–∞—É–Ω—Ç –∑–∞—Ö–æ–¥—è—Ç –±–µ–∑ –ø—Ä–µ–º –ø–æ–¥–ø–∏—Å–∫–∏\n<br><br>Geo RU',
        "minimum": 1,
        "bt_id": 207
    },
    6: {
        "text": '‚≠êÔ∏è 14+ days subscribers',
        "price": 0.045,
        "price_text": '45‚ÇΩ –∑–∞ 1000',
        "description": '–°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–∞ –Ω–∞ –∫–∞–Ω–∞–ª –±–µ–∑ –∑–∞—è–≤–æ–∫<br><br>–¢–µ–ª–µ–≥—Ä–∞–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.<br>–û—Ç–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ 14+ –¥–Ω–µ–π<br>–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫',
        "minimum": 1,
        "bt_id": 203
    },
    7: {
        "text": '‚≠êÔ∏è 30+ days subsrcibers',
        "price": 0.08,
        "price_text": '80‚ÇΩ –∑–∞ 1000',
        "description": '–°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–∞ –Ω–∞ –∫–∞–Ω–∞–ª –±–µ–∑ –∑–∞—è–≤–æ–∫<br><br>–¢–µ–ª–µ–≥—Ä–∞–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∏.<br>–û—Ç–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ 30+ –¥–Ω–µ–π<br>–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫',
        "minimum": 1,
        "bt_id": 204
    },
    8: {
        "text": '‚≠êÔ∏è 180+ days subsrcibers',
        "price": 0.3,
        "price_text": '300‚ÇΩ –∑–∞ 1000',
        "description": '–ë–µ–∑ –¥—Ä–æ–ø–∞ –º–∏–Ω–∏–º—É–º 180 –¥–Ω–µ–π!<br><br>üîç–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫!<br><br>‚ù§Ô∏è –£ 100% –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –µ—Å—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, –∏–º–µ–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∞–≤–∞—Ç–∞—Ä–∫–∞–º.<br><br>–ì–µ–æ - –ú–ò–ö–°.<br><br>–ü—Ä–∞–≤–∏–ª–∞:<br>- –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã: –Ω–∞—Ä–∫–æ—Ç–∏–∫–∏, –ª–æ—Ö–æ—Ç—Ä–æ–Ω, –ø–æ—Ä–Ω–æ, –ø—É—Å—Ç—ã–µ –∫–∞–Ω–∞–ª—ã.<br>- –ö–∞–Ω–∞–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –±–æ–ª–µ–µ 2 –Ω–µ–¥–µ–ª—å!!!<br>- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 –ø–æ—Å—Ç–∞ –Ω–∞ –∫–∞–Ω–∞–ª–µ. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤ —Ä–∞–∑–Ω—ã–µ –¥–Ω–∏.<br>- –ú—ã –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ –ì–†–£–ü–ü–´ –∏ –ß–ê–¢–´ —Å –¥–∞—Ç–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω–µ–µ –≥–æ–¥–∞ –Ω–∞–∑–∞–¥.',
        "minimum": 10,
        "bt_id": 75
    },
    9: {
        "text": 'üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –Ω–∞ 50 –ø–æ—Å—Ç–æ–≤',
        "price": 0.25,
        "price_text": '250‚ÇΩ –∑–∞ 1000',
        "description": '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∏–∑ –†–æ—Å—Å–∏–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 –ø–æ—Å—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª–µ.<br>–ü–æ–ø–∞–¥–∞—é—Ç –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.<br><br>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –µ—Å–ª–∏ –≤ –ø–æ—Å—Ç–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–æ –∫–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π, –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç.',
        "minimum": 100,
        "bt_id": 166
    },
    10: {
        "text": 'üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –Ω–∞ 20 –ø–æ—Å—Ç–æ–≤',
        "price": 0.09,
        "price_text": '90‚ÇΩ –∑–∞ 1000',
        "description": '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∏–∑ –†–æ—Å—Å–∏–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 –ø–æ—Å—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª–µ.<br>–ü–æ–ø–∞–¥–∞—é—Ç –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.<br><br>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –µ—Å–ª–∏ –≤ –ø–æ—Å—Ç–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–æ –∫–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π, –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç.',
        "minimum": 100,
        "bt_id": 165
    },
    11: {
        "text": 'üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –Ω–∞ 10 –ø–æ—Å—Ç–æ–≤',
        "price": 0.045,
        "price_text": '45‚ÇΩ –∑–∞ 1000',
        "description": '–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∏–∑ –†–æ—Å—Å–∏–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ø–æ—Å—Ç–æ–≤ –Ω–∞ –∫–∞–Ω–∞–ª–µ.<br>–ü–æ–ø–∞–¥–∞—é—Ç –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.<br><br>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –µ—Å–ª–∏ –≤ –ø–æ—Å—Ç–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–æ –∫–∞–∂–¥–æ–µ —Ñ–æ—Ç–æ –±—É–¥–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —Å–∏—Å—Ç–µ–º–æ–π, –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Å—Ç.',
        "minimum": 100,
        "bt_id": 164
    },
    12: {
        "text": 'üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã –Ω–∞ 1 –ø–æ—Å—Ç',
        "price": 0.01,
        "price_text": '10‚ÇΩ –∑–∞ 1000',
        "description": '–£–∫–∞–∑—ã–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–æ—Å—Ç.<br>–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Å —Ä—É—Å—Å–∫–∏—Ö ip –∞–¥—Ä–µ—Å–æ–≤',
        "minimum": 100,
        "bt_id": 163
    },
}

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
conn = sqlite3.connect('db.db')
cursor = conn.cursor()

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª—é—á–µ–π
cursor.execute('SELECT api_key FROM boosttelega')
valid_keys = [row[0] for row in cursor.fetchall()]
conn.close()

# –°–ø–∏—Å–æ–∫ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∫–ª—é—á–µ–π
valid_keys = []  # –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∫–ª—é—á–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

@app.get("/api/v2")
def api_v2(
    action: str = Query(...),
    service: int = Query(...),
    link: str = Query(...),
    quantity: int = Query(...),
    key: str = Query(...)
):
    if key not in valid_keys:
        return {"error": "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –∫–ª—é—á"}

    if action != "add":
        return {"error": "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ"}

    if service not in services:
        return {"error": "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å–ª—É–≥–∞"}

    if quantity < services[service]["minimum"]:
        return {"error": f"–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è —É—Å–ª—É–≥–∏ {services[service]['text']} —Ä–∞–≤–Ω–æ {services[service]['minimum']}"}

    # –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
    order_id = create_order(service, link, quantity)
    if order_id:
        return {"message": "–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω", "order_id": order_id}
    else:
        return {"error": "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞"}

def create_order(service_id, link, quantity):
    # –õ–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–∫–∞–∑–∞ –∑–¥–µ—Å—å
    # –ù–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    # –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π ID
    import random
    return random.randint(1000, 9999)

